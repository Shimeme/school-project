<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>設定 - FridgeFlow</title>
    <link rel="stylesheet" href="css/style.css" />
</head>
<body>
    <nav class="navbar">
        <div class="container d-flex justify-content-between align-items-center">
            <a href="home.html" class="navbar-brand">❄️ FridgeFlow</a>
            <ul class="navbar-nav">
                <li class="nav-item"><a href="dashboard.html" class="nav-link">ダッシュボード</a></li>
                <li class="nav-item"><a href="analytics.html" class="nav-link ">アナリティクス</a></li>
                <li class="nav-item"><a href="fridges.html" class="nav-link">マイ冷蔵庫</a></li>
                <li class="nav-item"><a href="inventory.html" class="nav-link">在庫管理</a></li>
                <li class="nav-item"><a href="alerts.html" class="nav-link">アラート</a></li>
                <li class="nav-item"><a href="settings.html" class="nav-link active">設定</a></li>
            </ul>
        </div>
    </nav>

    <section id="settings" class="section" style="padding-top: 6rem;">
        <div class="container">
            <h2 class="text-center mb-3">システム設定</h2>
            
            <div class="row">
                <div class="col-6">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">アラート設定</h3>
                        </div>
                        <div class="card-body">
                            <div class="form-group">
                                <label class="form-label">賞味期限警告（日数）</label>
                                <input type="number" class="form-control" value="3" id="expirationWarning">
                            </div>
                            <div class="form-group">
                                <label class="form-label">温度しきい値 (°C)</label>
                                <input type="number" class="form-control" value="0" id="tempThreshold">
                            </div>
                            <div class="form-group">
                                <label class="form-label">通知用メールアドレス</label>
                                <input type="email" class="form-control" placeholder="admin@fridgeflow.com" id="notificationEmail">
                            </div>
                        </div>
                        <div class="card-footer text-right">
                            <button class="btn btn-primary" id="saveConfigBtn">設定を保存</button>
                        </div>
                    </div>
                </div>
                
                <div class="col-6">
                    <div class="card mb-3">
                        <div class="card-header">
                            <h3 class="card-title">冷蔵庫温度編集</h3>
                        </div>
                        <div class="card-body" id="fridgeTempEditors">
                            <p>読み込み中...</p>
                        </div>
                        <div class="card-footer text-right">
                            <button class="btn btn-primary" id="saveTempsBtn">温度を保存</button>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">システム状態</h3>
                        </div>
                        <div class="card-body">
                            <p><strong>システムバージョン：</strong>v2.1.0</p>
                            <p><strong>最終バックアップ：</strong>2025-07-07 12:00</p>
                            <p><strong>データベースサイズ：</strong>15.2 MB</p>
                            <p><strong>稼働時間：</strong>7日 14時間</p>
                            <p><strong>アクティブ接続数：</strong>3/5</p>
                        </div>
                        <div class="card-footer">
                            <button class="btn btn-secondary">診断を実行</button>
                            <button class="btn btn-ghost">データをエクスポート</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

<script>
document.addEventListener("DOMContentLoaded", () => {
    let fridgesData = [];

    const fridgeTempEditors = document.getElementById("fridgeTempEditors");
    const saveTempsBtn = document.getElementById("saveTempsBtn");

    fetch("system/fridges.json")
        .then(response => {
            if (!response.ok) throw new Error("ファイルの読み込みに失敗しました");
            return response.json();
        })
        .then(data => {
            fridgesData = data;
            renderTempEditors(data);
        })
        .catch(error => {
            fridgeTempEditors.innerHTML = `<p>冷蔵庫データの読み込みエラー: ${error.message}</p>`;
        });

    function renderTempEditors(data) {
        if (!data || data.length === 0) {
            fridgeTempEditors.innerHTML = "<p>冷蔵庫データがありません</p>";
            return;
        }
        fridgeTempEditors.innerHTML = "";
        data.forEach((fridge, index) => {
            if(fridge.status !== 'ONLINE') return; // Do not show offline fridges
            const div = document.createElement("div");
            div.className = "form-group mb-2";
            div.innerHTML = `
                <label class="form-label">${fridge.id} の温度 (°C)</label>
                <input type="number" class="form-control temp-input" data-index="${index}" value="${fridge.temp !== null ? fridge.temp : ''}" placeholder="N/A" />
            `;
            fridgeTempEditors.appendChild(div);
        });
    }

    if (saveTempsBtn) {
        saveTempsBtn.addEventListener("click", () => {
            const inputs = document.querySelectorAll(".temp-input");
            inputs.forEach(input => {
                const idx = input.dataset.index;
                let val = input.value;
                fridgesData[idx].temp = val === "" ? null : Number(val);
            });
            console.log("Updated fridges.json data to be saved:", fridgesData);
            alert("温度が更新されました（デモのため、実際の保存は無効です）");
        });
    }

    const saveConfigBtn = document.getElementById("saveConfigBtn");
    if (saveConfigBtn) {
        saveConfigBtn.addEventListener("click", () => {
            alert("設定が保存されました（デモのため、実際の保存は無効です）");
        });
    }
});
</script>

</body>
</html>